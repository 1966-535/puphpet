{% import _self as format %}

{% if php.version == 'php55' %}
    {% set php_ppa = 'ppa:ondrej/php5-experimental' %}
{% elseif php.version == 'php54' %}
    {% set php_ppa = 'ppa:ondrej/php5' %}
{% else %}
    {% set php_ppa = false %}
{% endif %}
group { 'puppet': ensure => present }
Exec { path => [ '/bin/', '/sbin/', '/usr/bin/', '/usr/sbin/' ] }
File { owner => 0, group => 0, mode => 0644 }

class {'apt':
  always_apt_update => true,
}

Class['::apt::update'] -> Package <|
    title != 'python-software-properties'
and title != 'software-properties-common'
|>

{% if php_ppa %}
apt::ppa { '{{ php_ppa|raw }}': }
{% endif %}

file { '/home/vagrant/.bash_aliases':
  ensure => 'present',
  source => 'puppet:///modules/puphpet/dot/.bash_aliases',
}

{% include 'Vagrant/Modules/server.pp.twig' %}

{% if nginx is defined %}
{% include 'Vagrant/Modules/nginx.pp.twig' %}
{% else %}
{% include 'Vagrant/Modules/apache.pp.twig' %}
{% endif %}

{% include 'Vagrant/Modules/php.pp.twig' %}

{% if database %}
{% if postgresql is defined %}
{% include 'Vagrant/Modules/postgresql.pp.twig' %}
{% else %}
{% include 'Vagrant/Modules/mysql.pp.twig' %}
{% endif %}
{% endif %}

{# global macros #}
{% macro explode_and_quote(list) %}
{% for entry in list %}    '{{ entry|raw }}'{% if not loop.last %},
{% endif %}{% endfor %}
{% endmacro %}
