exec { 'apt-get update' :
    command => 'apt-get update',
    path    => '/usr/bin/',
    timeout => 60,
    tries   => 3
}

class { 'apt' :
    always_apt_update => true
}

package { ['python-software-properties'] :
    ensure  => 'installed',
    require => Exec['apt-get update'],
}

file { '/home/vagrant/.bash_aliases' :
    source => 'puppet:///modules/puphpet/dot/.bash_aliases',
    ensure => 'present',
}

{% include 'Vagrant/Modules/server.twig' %}

{% include 'Vagrant/Modules/apache.twig' %}



{% if mysql.root %}
class { 'mysql' :
    root_password => '{{ mysql.root }}',
}

{% if mysql.db is not empty %}
{% for database in mysql.db %}
mysql::grant { '{{ database.dbname }}' :
    mysql_privileges     => '{{ database.privileges|join(', ')|raw }}',
    mysql_db             => '{{ database.dbname }}',
    mysql_user           => '{{ database.user }}',
    mysql_password       => '{{ database.password }}',
    mysql_host           => '{{ database.host }}',
    mysql_grant_filepath => '/home/vagrant/puppet-mysql',
}
{% endfor %}
{% endif %}
{% endif %}
