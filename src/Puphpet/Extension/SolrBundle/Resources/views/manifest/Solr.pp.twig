if $solr_values == undef { $solr_values = hiera_hash('solr', false) }

include puphpet::params

if hash_key_equals($solr_values, 'install', 1)
{

  case $osfamily {
    'Redhat': {
      $jre = 'java-1.8.0-openjdk'
      $dependency = 'yum-update'

      exec {'yum makecache':
        path   => '/usr/bin',
        alias  => $dependency,
      }
    }

    'Debian': {
      $jre = 'openjdk-7-jre'
      $dependency = 'apt-get-update'

      exec {'apt-get update':
        path  => '/usr/bin',
        alias => $dependency,
      }
    }

    default: { fail("Supports only CentOS/RHEL and Ubuntu/Debian. You have used: ${operatingsystem}.") }
  }

  package { $jre:
    ensure  => installed,
    alias   => 'jre',
    require => Exec[$dependency],
  }

  class {'solr::jetty':
    # Use closest mirror to avoid timeout issues.
    # apache_mirror => 'http://apache-mirror.rbc.ru/pub/apache',
    require => Package['jre'],
  }

}
